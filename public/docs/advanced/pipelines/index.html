<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=64317&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Codon extends the core Python language with a pipe operator. You can
chain multiple functions and generators to form a pipeline. Pipeline
stages can be regular functions or generators. In the case of standard
functions, the function is simply applied to the input data and the
result is carried to the remainder of the pipeline, akin to F#&#39;s
functional piping. If, on the other hand, a stage is a generator, the
values yielded by the generator are passed lazily to the remainder of
the pipeline, which in many ways mirrors how piping is implemented in
Bash. Note that Codon ensures that generator pipelines do not collect
any data unless explicitly requested, thus allowing the processing of
terabytes of data in a streaming fashion with no memory and minimal CPU
overhead.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:64317/docs/advanced/pipelines/">
  <meta property="og:site_name" content="Codon Docs">
  <meta property="og:title" content="Codon Docs">
  <meta property="og:description" content="Codon extends the core Python language with a pipe operator. You can chain multiple functions and generators to form a pipeline. Pipeline stages can be regular functions or generators. In the case of standard functions, the function is simply applied to the input data and the result is carried to the remainder of the pipeline, akin to F#&#39;s functional piping. If, on the other hand, a stage is a generator, the values yielded by the generator are passed lazily to the remainder of the pipeline, which in many ways mirrors how piping is implemented in Bash. Note that Codon ensures that generator pipelines do not collect any data unless explicitly requested, thus allowing the processing of terabytes of data in a streaming fashion with no memory and minimal CPU overhead.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Pipelines | Codon Docs</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:64317/docs/advanced/pipelines/">
<link rel="stylesheet" href="/book.min.a7616cf2799b58bddffce9438e31fdbfc6393687cfc0950a4a17cd1cce7e35f6.css" integrity="sha256-p2Fs8nmbWL3f/OlDjjH9v8Y5NofPwJUKShfNHM5&#43;NfY=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.79232047380378170069d6b569a32e1a092f8edee4c96196b8b442424dc13da3.js" integrity="sha256-eSMgRzgDeBcAada1aaMuGgkvjt7kyWGWuLRCQk3BPaM=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Codon Docs</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/build/" class="">Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/gpu/" class="">Gpu</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/ir/" class="">Ir</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/parallel/" class="">Parallel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/advanced/pipelines/" class="active">Pipelines</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interop/cpp/" class="">Cpp</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interop/decorator/" class="">Decorator</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interop/jupyter/" class="">Jupyter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interop/numpy/" class="">Numpy</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interop/pyext/" class="">Pyext</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interop/python/" class="">Python</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/differences/" class="">Differences</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/faq/" class="">Faq</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/intro/" class="">Intro</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/releases/" class="">Releases</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/roadmap/" class="">Roadmap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/basics/" class="">Basics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/classes/" class="">Classes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/collections/" class="">Collections</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/extra/" class="">Extra</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/ffi/" class="">Ffi</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/functions/" class="">Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/generators/" class="">Generators</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/llvm/" class="">Llvm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/language/statics/" class="">Statics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/readme/" class="">Readme</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/summary/" class="">Summary</a>
  

        </li>
      
    
  </ul>










  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Pipelines</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents"></nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><p>Codon extends the core Python language with a pipe operator. You can
chain multiple functions and generators to form a pipeline. Pipeline
stages can be regular functions or generators. In the case of standard
functions, the function is simply applied to the input data and the
result is carried to the remainder of the pipeline, akin to F#'s
functional piping. If, on the other hand, a stage is a generator, the
values yielded by the generator are passed lazily to the remainder of
the pipeline, which in many ways mirrors how piping is implemented in
Bash. Note that Codon ensures that generator pipelines do not collect
any data unless explicitly requested, thus allowing the processing of
terabytes of data in a streaming fashion with no memory and minimal CPU
overhead.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add1</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#f92672">|&gt;</span> add1  <span style="color:#75715e"># 3; equivalent to add1(2)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc</span>(x, y):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">+</span> y<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#f92672">|&gt;</span> calc(<span style="color:#ae81ff">3</span>)       <span style="color:#75715e"># 11; equivalent to calc(2, 3)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#f92672">|&gt;</span> calc(<span style="color:#f92672">...</span>, <span style="color:#ae81ff">3</span>)  <span style="color:#75715e"># 11; equivalent to calc(2, 3)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#f92672">|&gt;</span> calc(<span style="color:#ae81ff">3</span>, <span style="color:#f92672">...</span>)  <span style="color:#75715e"># 7; equivalent to calc(3, 2)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen</span>(i):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(i):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> <span style="color:#f92672">|&gt;</span> gen <span style="color:#f92672">|&gt;</span> print <span style="color:#75715e"># prints 0 1 2 3 4 separated by newline</span>
</span></span><span style="display:flex;"><span>range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>) <span style="color:#f92672">|&gt;</span> iter <span style="color:#f92672">|&gt;</span> gen <span style="color:#f92672">|&gt;</span> print(end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39; &#39;</span>)  <span style="color:#75715e"># prints 0 0 1 0 1 2 without newline</span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>] <span style="color:#f92672">|&gt;</span> print   <span style="color:#75715e"># prints [1, 2, 3]</span>
</span></span><span style="display:flex;"><span>range(<span style="color:#ae81ff">100000000</span>) <span style="color:#f92672">|&gt;</span> print  <span style="color:#75715e"># prints range(0, 100000000)</span>
</span></span><span style="display:flex;"><span>range(<span style="color:#ae81ff">100000000</span>) <span style="color:#f92672">|&gt;</span> iter <span style="color:#f92672">|&gt;</span> print  <span style="color:#75715e"># not only prints all those numbers, but it uses almost no memory at all</span>
</span></span></code></pre></div><p>Codon will chain anything that implements <code>__iter__</code>, and the compiler
will optimize out generators whenever possible. Combinations of pipes
and generators can be used to implement efficient streaming pipelines.</p>
<p>{% hint style=&ldquo;warning&rdquo; %}
The Codon compiler may perform optimizations that change the order of
elements passed through a pipeline. Therefore, it is best to not rely on
order when using pipelines. If order needs to be maintained, consider
using a regular loop or passing an index alongside each element sent
through the pipeline.
{% endhint %}</p>
<h1 id="parallel-pipelines">
  Parallel pipelines
  <a class="anchor" href="#parallel-pipelines">#</a>
</h1>
<p>CPython and many other implementations alike cannot take advantage of
parallelism due to the infamous global interpreter lock, a mutex that
prevents multiple threads from executing Python bytecode at once. Unlike
CPython, Codon has no such restriction and supports full multithreading.
To this end, Codon supports a <em>parallel</em> pipe operator <code>||&gt;</code>, which is
semantically similar to the standard pipe operator except that it allows
the elements sent through it to be processed in parallel by the
remainder of the pipeline. Hence, turning a serial program into a
parallel one often requires the addition of just a single character in
Codon. Further, a single pipeline can contain multiple parallel pipes,
resulting in nested parallelism.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>range(<span style="color:#ae81ff">100000</span>) <span style="color:#f92672">|&gt;</span> iter <span style="color:#f92672">||&gt;</span> print              <span style="color:#75715e"># prints all these numbers, probably in random order</span>
</span></span><span style="display:flex;"><span>range(<span style="color:#ae81ff">100000</span>) <span style="color:#f92672">|&gt;</span> iter <span style="color:#f92672">||&gt;</span> process <span style="color:#f92672">||&gt;</span> clean  <span style="color:#75715e"># runs process in parallel, and then cleans data in parallel</span>
</span></span></code></pre></div><p>Codon will automatically schedule the <code>process</code> and <code>clean</code> functions to
execute as soon as possible. You can control the number of threads via
the <code>OMP_NUM_THREADS</code> environment variable.</p>
<p>Internally, the Codon compiler uses an OpenMP task backend to generate
code for parallel pipelines. Logically, parallel pipe operators are
similar to parallel-for loops: the portion of the pipeline after the
parallel pipe is outlined into a new function that is called by the
OpenMP runtime task spawning routines (as in <code>#pragma omp task</code> in C++),
and a synchronization point (<code>#pragma omp taskwait</code>) is added after the
outlined segment.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents"></nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












